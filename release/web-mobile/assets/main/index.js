System.register("chunks:///_virtual/Bean.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var i,n,t,r,a,u,o,l,c;return{setters:[function(e){i=e.applyDecoratedDescriptor,n=e.inheritsLoose,t=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){a=e.cclegacy,u=e._decorator,o=e.SpriteFrame,l=e.Sprite,c=e.Component}],execute:function(){var p,b,s,g,f,y,h,m,w,z,q,d,v,_,B,F,S,V,C,A,D,T,I,L;a._RF.push({},"9023aI/BVtFK75AF0OOlMAQ","Bean",void 0);var M=u.ccclass,O=u.property,P=e("BeanType",function(e){return e.caomei="caomei",e.tudou="tudou",e.mifan="mifan",e.nangua="nangua",e.qiezi="qiezi",e.huluobo="huluobo",e.bingqilin="bingqilin",e.wawacai="wawacai",e.qingcai="qingcai",e.baozi="baozi",e}({}));e("Bean",(p=M("Bean"),b=O({type:o}),s=O({type:o}),g=O({type:o}),f=O({type:o}),y=O({type:o}),h=O({type:o}),m=O({type:o}),w=O({type:o}),z=O({type:o}),q=O({type:o}),p((_=i((v=function(e){function i(){for(var i,n=arguments.length,a=new Array(n),u=0;u<n;u++)a[u]=arguments[u];return(i=e.call.apply(e,[this].concat(a))||this).type=P.mifan,t(i,"_energyValue",_,r(i)),t(i,"caomei",B,r(i)),t(i,"tudou",F,r(i)),t(i,"nangua",S,r(i)),t(i,"qiezi",V,r(i)),t(i,"huluobo",C,r(i)),t(i,"bingqilin",A,r(i)),t(i,"wawacai",D,r(i)),t(i,"qingcai",T,r(i)),t(i,"baozi",I,r(i)),t(i,"mifan",L,r(i)),i}n(i,e);var a=i.prototype;return a.getEnergy=function(){return this._energyValue},a.getCurrentSprite=function(){switch(this.type){case P.mifan:return this.mifan;case P.nangua:return this.nangua;case P.caomei:return this.caomei;case P.bingqilin:return this.bingqilin;case P.baozi:return this.baozi;case P.tudou:return this.tudou;case P.qiezi:return this.qiezi;case P.wawacai:return this.wawacai;case P.qingcai:return this.qingcai;case P.huluobo:return this.huluobo}},a.setType=function(e,i){this.type=e,this._energyValue=i;var n=this.getComponent(l);n&&(n.spriteFrame=this.getCurrentSprite())},i}(c)).prototype,"_energyValue",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),B=i(v.prototype,"caomei",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=i(v.prototype,"tudou",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=i(v.prototype,"nangua",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=i(v.prototype,"qiezi",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=i(v.prototype,"huluobo",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=i(v.prototype,"bingqilin",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=i(v.prototype,"wawacai",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=i(v.prototype,"qingcai",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=i(v.prototype,"baozi",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=i(v.prototype,"mifan",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=v))||d));a._RF.pop()}}}));

System.register("chunks:///_virtual/BeanManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Bean.ts","./GameManager.ts"],(function(e){var n,t,o,a,i,r,s,l,h,c,g,u,p,f,y,d,b,w,v;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,o=e.initializerDefineProperty,a=e.assertThisInitialized},function(e){i=e.cclegacy,r=e._decorator,s=e.Prefab,l=e.CCInteger,h=e.UITransform,c=e.instantiate,g=e.Vec3,u=e.Tween,p=e.Node,f=e.Label,y=e.Color,d=e.Component},function(e){b=e.Bean,w=e.BeanType},function(e){v=e.GameManager}],execute:function(){var m,C,M,B,P,_,T;i._RF.push({},"334eddAenlGxpngQYXoA3Kj","BeanManager",void 0);var z=r.ccclass,x=r.property;e("BeanManager",(m=z("BeanManager"),C=x(s),M=x(l),m((_=n((P=function(e){function n(){for(var n,t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return n=e.call.apply(e,[this].concat(i))||this,o(n,"beanPrefab",_,a(n)),o(n,"beanCount",T,a(n)),n._beans=[],n.beanConfigs=[{type:w.caomei,energy:10,weight:1},{type:w.nangua,energy:10,weight:1},{type:w.qiezi,energy:10,weight:1},{type:w.tudou,energy:20,weight:1},{type:w.wawacai,energy:10,weight:1},{type:w.qingcai,energy:10,weight:1},{type:w.mifan,energy:20,weight:1},{type:w.bingqilin,energy:40,weight:1},{type:w.baozi,energy:40,weight:1},{type:w.huluobo,energy:10,weight:1}],n}t(n,e);var i=n.prototype;return i.start=function(){var e=this;this.scheduleOnce((function(){return e.spawnBeans()}),.5)},i.spawnBeans=function(){var e,n=null==(e=this.node.getChildByName("Cat"))?void 0:e.position,t=16,o=Array(t).fill(null).map((function(){return Array(t).fill(!1)})),a=this.generateTypePool(),i=this.node.getComponent(h);if(i){var r=i.contentSize,s=i.anchorPoint,l=-r.width*s.x,u=r.width*(1-s.x),p=-r.height*s.y,f=r.height*(1-s.y);console.log("地图尺寸计算:","宽: "+r.width+" 高: "+r.height,"锚点: ("+s.x+", "+s.y+")","X范围: ["+l+", "+u+"]","Y范围: ["+p+", "+f+"]");for(var y=0;y<this.beanCount;y++){var d=!1,w=0,m=void 0;m=c(this.beanPrefab);var C=a[y%a.length],M=m.getComponent(b);for(M&&M.setType(C.type,C.energy);!d&&w<10;){var B=void 0,P=void 0;do{B=Math.floor(Math.random()*t),P=Math.floor(Math.random()*t)}while(o[B][P]);o[B][P]=!0;var _=(u-l)/t,T=(f-p)/t,z=new g(l+B*_+_/2,p+P*T+T/2,0);(d=this.checkSafePosition(z,n,50))&&(this.node.addChild(m),m.setPosition(z),m.active=!0,this._beans.push(m)),w++}}this.node.parent.getComponent(v).setTotalBeans(this._beans.length)}else console.error("UITransform component missing on BeanManager node!")},i.removeBean=function(e){var n,t=this,o=null==(n=e.getComponent(b))?void 0:n.getEnergy(),a=this._beans.indexOf(e);if(-1!==a){var i,r=null==(i=e.getComponent(b))?void 0:i.type;new u(e).to(.3,{scale:new g(.1,.1,1)},{easing:"sineOut"}).call((function(){e.destroy(),t.showEnergyLabel(e.position,o)})).start(),this._beans.splice(a,1);var s=this.node.parent.getComponent(v);s&&r?s.beanEaten(r,o):console.error("GameManager component not found in BeanManager")}},i.showEnergyLabel=function(e,n){var t=new p,o=t.addComponent(f);o.string="+"+n,o.fontSize=30,o.color=y.GREEN,this.node.addChild(t),t.setPosition(e),new u(t).to(.8,{position:new g(e.x,e.y+80,0)}).call((function(){return t.destroy()})).start()},i.generateTypePool=function(){var e=[];return this.beanConfigs.forEach((function(n){var t=Math.floor(3*n.weight);e.push.apply(e,Array(t).fill(n))})),e.sort((function(){return Math.random()-.5}))},i.checkSafePosition=function(e,n,t){return!(e.subtract(n).length()<150)&&this._beans.every((function(n){return n.position.clone().subtract(e).length()>=t}))},n}(d)).prototype,"beanPrefab",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=n(P.prototype,"beanCount",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),B=P))||B));i._RF.pop()}}}));

System.register("chunks:///_virtual/GameManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PlayerController.ts","./SlotComponent.ts"],(function(n){var t,e,o,i,r,a,l,s,u,c,h;return{setters:[function(n){t=n.applyDecoratedDescriptor,e=n.inheritsLoose,o=n.initializerDefineProperty,i=n.assertThisInitialized},function(n){r=n.cclegacy,a=n._decorator,l=n.Label,s=n.Node,u=n.Component},function(n){c=n.PlayerController},function(n){h=n.SlotComponent}],execute:function(){var f,p,g,y,d,b,m,S,v,_,E;r._RF.push({},"6edb1Ge/VFIj5XKsNBHot4r","GameManager",void 0);var w=a.ccclass,C=a.property;n("GameManager",(f=w("GameManager"),p=C(l),g=C(l),y=C([s]),d=C(s),f((S=t((m=function(n){function t(){for(var t,e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];return t=n.call.apply(n,[this].concat(r))||this,o(t,"countLabel",S,i(t)),o(t,"winLabel",v,i(t)),o(t,"slotNodes",_,i(t)),o(t,"player",E,i(t)),t._remainingBeans=0,t.currentSlots=[null,null,null,null,null],t.MAX_SLOTS=5,t._totalEnergy=20,t}e(t,n);var r=t.prototype;return r.decreaseEnergy=function(n){return this._totalEnergy=Math.max(0,this._totalEnergy-n),this.updateCountLabel(),this._totalEnergy},r.start=function(){this.initSlots(),this.winLabel.node.active=!1,this.updateCountLabel()},r.beanEaten=function(n,t){console.log("剩余豆豆数量:",this._remainingBeans),this._remainingBeans--,this.addEnergy(t),console.log("更新后剩余:",this._remainingBeans),this._remainingBeans<=0&&(console.log("触发胜利条件"),this.showWin()),this.addToSlot(n)},r.setTotalBeans=function(n){this._remainingBeans=n},r.updateCountLabel=function(){this.countLabel.string="能量: "+Math.floor(this._totalEnergy)},r.initSlots=function(){this.currentSlots.fill(null)},r.showWin=function(){this.winLabel.node.active=!0,this.winLabel.string="游戏胜利！",this.scheduleOnce((function(){window.location.reload()}),2)},r.addToSlot=function(n){var t=this.currentSlots.indexOf(null);if(-1===t){var e;if(this.player)null==(e=this.player.getComponent(c))||e.setMovementEnabled(!1);else console.warn("Player node is not assigned in GameManager");return!1}return this.currentSlots[t]=n,this.updateSlotDisplay(t,n),this.checkCombination(),!0},r.updateSlotDisplay=function(n,t){var e=this.slotNodes[n];if(e){var o=e.getComponent(h);o&&o.showBean(t)}},r.checkCombination=function(){var n=this,t=new Map;this.currentSlots.forEach((function(n){null!==n&&t.set(n,(t.get(n)||0)+1)})),t.forEach((function(t,e){t>=3&&n.clearSlotsByType(e)}))},r.clearSlotsByType=function(n){var t,e=this;this.currentSlots.forEach((function(t,o){if(t===n){e.currentSlots[o]=null;var i=e.slotNodes[o];if(i){var r=i.getComponent(h);null==r||r.playClearAnimation((function(){}))}}})),null==(t=this.player.getComponent(c))||t.setMovementEnabled(!0)},r.addEnergy=function(n){this._totalEnergy+=n,console.log("当前累计能量:",this._totalEnergy),this.updateCountLabel()},r.getCurrentEnergy=function(){return this._totalEnergy},t}(u)).prototype,"countLabel",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=t(m.prototype,"winLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(m.prototype,"slotNodes",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),E=t(m.prototype,"player",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=m))||b));r._RF.pop()}}}));

System.register("chunks:///_virtual/Joystick.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,o,n,e,s,c,r,a,u,h,l,p,y;return{setters:[function(t){i=t.applyDecoratedDescriptor,o=t.inheritsLoose,n=t.createClass,e=t.initializerDefineProperty,s=t.assertThisInitialized},function(t){c=t.cclegacy,r=t._decorator,a=t.Node,u=t.input,h=t.Input,l=t.UITransform,p=t.Vec2,y=t.Component}],execute:function(){var T,_,v,d,f;c._RF.push({},"ae3eesTLbNG7pvAzvq5vkAw","Joystick",void 0);var g=r.ccclass,k=r.property;t("Joystick",(T=g("Joystick"),_=k(a),T((f=i((d=function(t){function i(){for(var i,o=arguments.length,n=new Array(o),c=0;c<o;c++)n[c]=arguments[c];return i=t.call.apply(t,[this].concat(n))||this,e(i,"stick",f,s(i)),i._maxRadius=50,i._inputVector=p.ZERO,i._isActive=!1,i._initialTouchPos=p.ZERO,i}o(i,t);var c=i.prototype;return c.onLoad=function(){u.on(h.EventType.TOUCH_START,this.onTouchStart,this),u.on(h.EventType.TOUCH_MOVE,this.onTouchMove,this),u.on(h.EventType.TOUCH_END,this.onTouchEnd,this)},c.onTouchStart=function(t){var i=t.getUILocation(),o=this.node.getComponent(l).getBoundingBoxToWorld();console.log("joystick touch",i,o,this.node.position),o.contains(new p(i.x,i.y))&&(this._isActive=!0,this._initialTouchPos=new p(i.x,i.y))},c.onTouchEnd=function(){this._isActive=!1,this.stick.setPosition(0,0,0),this._inputVector=p.ZERO},c.onTouchMove=function(t){if(this._isActive){var i=t.getUILocation(),o=new p(i.x-this._initialTouchPos.x,i.y-this._initialTouchPos.y),n=o.length();n>this._maxRadius&&o.multiplyScalar(this._maxRadius/n),this.stick.setPosition(o.x,o.y,0),this._inputVector=o.normalize()}},n(i,[{key:"direction",get:function(){return this._inputVector.clone()}}]),i}(y)).prototype,"stick",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=d))||v));c._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./Bean.ts","./BeanManager.ts","./GameManager.ts","./Joystick.ts","./PlayerController.ts","./SlotComponent.ts"],(function(){return{setters:[null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/PlayerController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Bean.ts","./GameManager.ts"],(function(e){var t,n,i,o,a,r,s,l,u,c,m,p,h,d,g,y,v;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){a=e.cclegacy,r=e._decorator,s=e.PhysicsSystem2D,l=e.Node,u=e.Collider2D,c=e.Contact2DType,m=e.Vec3,p=e.Vec2,h=e.UITransform,d=e.Size,g=e.Component},function(e){y=e.Bean},function(e){v=e.GameManager}],execute:function(){var f,_,C,b,M,B,k,S,P,x,D;a._RF.push({},"1959d8gF4dG8oLeRHRhvmQb","PlayerController",void 0);var z=r.ccclass,A=r.property;s.instance.enable=!0;e("PlayerController",(f=z("PlayerController"),_=A(l),C=A(l),b=A(l),f((k=t((B=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return t=e.call.apply(e,[this].concat(a))||this,i(t,"joystick",k,o(t)),i(t,"map",S,o(t)),i(t,"moveSpeed",P,o(t)),i(t,"moveCostPerUnit",x,o(t)),t._accumulatedDistance=0,t._joystickComp=null,t._mapBoundary={minX:-350,maxX:350,minY:-350,maxY:350},i(t,"maskSprite",D,o(t)),t._gameManager=void 0,t._targetAngle=0,t._currentAngle=0,t._rotationSpeed=20,t}n(t,e);var a=t.prototype;return a.onLoad=function(){this._joystickComp=this.joystick.getComponent("Joystick")},a.start=function(){var e=this.getComponent(u);e&&(console.log("1"),e.on(c.BEGIN_CONTACT,this.onCollisionBegin,this)),this._gameManager=this.node.parent.parent.getComponent(v)},a.onCollisionBegin2=function(e,t){if(console.log("2"),"Bean"===t.node.name){var n,i=null==(n=this.node.parent)?void 0:n.getComponent("BeanManager");null==i||i.removeBean(t.node)}},a.onCollisionBegin=function(e,t){if("Bean"===t.node.name){t.node.getComponent(y);var n,i=null==(n=this.node.parent)?void 0:n.getComponent("BeanManager");null==i||i.removeBean(t.node)}},a.update=function(e){var t,n,i,o=this._joystickComp.direction,a=new m(o.x*this.moveSpeed*e,o.y*this.moveSpeed*e,0);o.equals(p.ZERO)||(this._targetAngle=180*Math.atan2(o.y,o.x)/Math.PI-90),this._currentAngle=(t=this._currentAngle,n=this._targetAngle,i=e*this._rotationSpeed,t+(n-t)*Math.min(i,1)),this.node.angle=this._targetAngle,this._accumulatedDistance+=a.length();var r=this.node.parent.parent.getComponent("GameManager");if((null==r?void 0:r.decreaseEnergy(this.moveCostPerUnit*this._accumulatedDistance))<=0)return a.set(0,0,0),void this.setMovementEnabled(!1);this._accumulatedDistance=0;var s=this.node.position.add(a);s.x=Math.max(Math.min(s.x,this._mapBoundary.maxX),this._mapBoundary.minX),s.y=Math.max(Math.min(s.y,this._mapBoundary.maxY),this._mapBoundary.minY),this.node.setPosition(s),this.updateMask()},a.updateMask=function(){if(this.maskSprite){var e=this._gameManager.getCurrentEnergy()/this.moveCostPerUnit;this.maskSprite.setPosition(this.node.position),this.maskSprite.getComponent(h).contentSize=new d(2*e,2*e)}},a.setMovementEnabled=function(e){this.node.active=!!e},t}(g)).prototype,"joystick",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=t(B.prototype,"map",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(B.prototype,"moveSpeed",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),x=t(B.prototype,"moveCostPerUnit",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),D=t(B.prototype,"maskSprite",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=B))||M));a._RF.pop()}}}));

System.register("chunks:///_virtual/SlotComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Bean.ts"],(function(e){var t,n,o,a,i,r,s,c,l,p,u,b;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,a=e.assertThisInitialized},function(e){i=e.cclegacy,r=e._decorator,s=e.Prefab,c=e.instantiate,l=e.Vec3,p=e.tween,u=e.Component},function(e){b=e.Bean}],execute:function(){var h,f,d,y,_;i._RF.push({},"d41b2Vqq3lFzra6UgD6AXr/","SlotComponent",void 0);var v=r.ccclass,m=r.property;e("SlotComponent",(h=v("SlotComponent"),f=m(s),h((_=t((y=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return t=e.call.apply(e,[this].concat(i))||this,o(t,"beanPrefab",_,a(t)),t._currentType=null,t._bean=void 0,t}n(t,e);var i=t.prototype;return i.showBean=function(e){this._currentType=e,this._bean=c(this.beanPrefab);var t=this._bean.getComponent(b);t&&t.setType(e,0),this.node.addChild(this._bean),this._bean.setPosition(l.ZERO),this._bean.active=!0},i.playClearAnimation=function(e){var t=this;p(this.node).to(.3,{scale:new l(1.2,1.2,1)}).to(.2,{scale:l.ZERO}).call((function(){t._bean.active=!1,t._bean.destroy(),t.node.scale=l.ONE,e()})).start()},t}(u)).prototype,"beanPrefab",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=y))||d));i._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});